rm(x.dropped.ind,x.filt.ind,x,y.full,y.full.big5,y.full.small5,y.na0)
TEJ1 <- DBfilter(x = TEJ,filename="表1.樣本篩選表",out="txt")
traceback()
DBfilter <- function(x = TEJ,filename="表1.樣本篩選表",out=c("csv","txt")){
x$year <- year(x$date)
x.filt.ind <- filter(x, !TSE_code %in% c("M2800","M9900","M2331","W91",NA))
x.dropped.ind <- filter(x, TSE_code %in% c("M2800","M9900","M2331","W91",NA))
# M2800金融業 # M9900其他 # M2331其他電子 # W91存託憑證
y.na0 <- x.filt.ind %>% filter(FAMILY %in% NA | PB %in% NA | TA %in% NA | NetSales %in% c(NA,0) | employee %in% c(NA,0) | is.na(QUICK) | is.na(OUTINSTI))
# if want to fill out all nas, use "na.omit"
# 主要篩了五個變數，家族na、本益比na、總資產na、淨銷貨0.na、員工人數0.NA
y.full <- x.filt.ind %>% filter(!is.na(FAMILY) & !is.na(PB) & !is.na(TA) & !NetSales %in% c(NA,0) & !employee %in% c(NA,0) & !is.na(QUICK) & !is.na(OUTINSTI))
y.full.big5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) >= 5)
y.full.small5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) < 5)
tbA1 <- data.frame(
"intro" = c('2001~2015 original sample amount'
,'delete "financial ind."(TSE ind. code: M2800)'
,'delete "other ind."(TSE ind. code: M9900)'
,'delete "other electronic ind."(TSE ind. code: M2331)'
,'delete "DRs"(TSE ind. code: W91)'
,'delete empty ind.'
,'delete samples which had missing value, and will affect the research'
,'delete ind. which sample amount less then 5 firms in a year(list in filt.ind.png)'
,'Total sample amount after filtering='),
"samp.amount" = c(NROW(x) # 原始樣本數
, -NROW(filter(x.dropped.ind, TSE_code == "M2800")) # 刪除金融
, -NROW(filter(x.dropped.ind, TSE_code == "M9900")) # 刪除其他
, -NROW(filter(x.dropped.ind, TSE_code == "M2331")) # 刪除M2331其他電子
, -NROW(filter(x.dropped.ind, TSE_code == "W91")) # 刪除W91存託憑證
, -NROW(filter(x.dropped.ind, is.na(TSE_code))) # 刪除缺產業值
, -NROW(y.na0) # 刪除其他缺漏
, -NROW(y.full.small5) # 刪除家數不足5筆
, NROW(y.full.big5)) # 全樣本合計
)
tab.ind <- table(y.full.small5$TSE_name,y.full.small5$year)
write.csv(na_count(y.na0),"其他闕漏值參考表.csv",row.names=TRUE)
if(out=="csv"){
filename <- capture.output(cat(filename,".csv",sep=""))
write.csv(tbA1, file=filename,row.names=FALSE)
write.csv(tab.ind, file="tab.ind.csv",row.names=FALSE)
}else{
#filename <- capture.output(cat(filename,".txt",sep=""))
#write(stargazer(tbA1,type = "text",summary = FALSE,align = c("r","r")),file = filename)
#write(xtable(tbA1,align="rrr",caption="",display = c(2,3)),file=filename)
table.png(obj=tbA1,name=filename,align="llr",caption="")
table.png(obj=tab.ind,name="tab.ind")
cat("Also print table ",filename,"in folder, complete.",sep="")
}
return(y.full.big5)
}
TEJ1 <- DBfilter(x = TEJ,filename="表1.樣本篩選表",out="txt")
traceback()
DBfilter <- function(x = TEJ,filename="表1.樣本篩選表",out=c("csv","txt")){
x$year <- year(x$date)
x.filt.ind <- filter(x, !TSE_code %in% c("M2800","M9900","M2331","W91",NA))
x.dropped.ind <- filter(x, TSE_code %in% c("M2800","M9900","M2331","W91",NA))
# M2800金融業 # M9900其他 # M2331其他電子 # W91存託憑證
y.na0 <- x.filt.ind %>% filter(FAMILY %in% NA | PB %in% NA | TA %in% NA | NetSales %in% c(NA,0) | employee %in% c(NA,0) | is.na(QUICK) | is.na(OUTINSTI))
# if want to fill out all nas, use "na.omit"
# 主要篩了五個變數，家族na、本益比na、總資產na、淨銷貨0.na、員工人數0.NA
y.full <- x.filt.ind %>% filter(!is.na(FAMILY) & !is.na(PB) & !is.na(TA) & !NetSales %in% c(NA,0) & !employee %in% c(NA,0) & !is.na(QUICK) & !is.na(OUTINSTI))
y.full.big5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) >= 5)
y.full.small5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) < 5)
tbA1 <- data.frame(
"intro" = c('2001~2015 original sample amount'
,'delete "financial ind."(TSE ind. code: M2800)'
,'delete "other ind."(TSE ind. code: M9900)'
,'delete "other electronic ind."(TSE ind. code: M2331)'
,'delete "DRs"(TSE ind. code: W91)'
,'delete empty ind.'
,'delete samples which had missing value, and will affect the research'
,'delete ind. which sample amount less then 5 firms in a year(list in filt.ind.png)'
,'Total sample amount after filtering='),
"samp.amount" = c(NROW(x) # 原始樣本數
, -NROW(filter(x.dropped.ind, TSE_code == "M2800")) # 刪除金融
, -NROW(filter(x.dropped.ind, TSE_code == "M9900")) # 刪除其他
, -NROW(filter(x.dropped.ind, TSE_code == "M2331")) # 刪除M2331其他電子
, -NROW(filter(x.dropped.ind, TSE_code == "W91")) # 刪除W91存託憑證
, -NROW(filter(x.dropped.ind, is.na(TSE_code))) # 刪除缺產業值
, -NROW(y.na0) # 刪除其他缺漏
, -NROW(y.full.small5) # 刪除家數不足5筆
, NROW(y.full.big5)) # 全樣本合計
)
tab.ind <- as.data.matrix(table(y.full.small5$TSE_name,y.full.small5$year))
write.csv(na_count(y.na0),"其他闕漏值參考表.csv",row.names=TRUE)
if(out=="csv"){
filename <- capture.output(cat(filename,".csv",sep=""))
write.csv(tbA1, file=filename,row.names=FALSE)
write.csv(tab.ind, file="tab.ind.csv",row.names=FALSE)
}else{
#filename <- capture.output(cat(filename,".txt",sep=""))
#write(stargazer(tbA1,type = "text",summary = FALSE,align = c("r","r")),file = filename)
#write(xtable(tbA1,align="rrr",caption="",display = c(2,3)),file=filename)
table.png(obj=tbA1,name=filename,align="llr",caption="")
table.png(obj=tab.ind,name="tab.ind")
cat("Also print table ",filename,"in folder, complete.",sep="")
}
return(y.full.big5)
}
TEJ1 <- DBfilter(x = TEJ,filename="表1.樣本篩選表",out="txt")
DBfilter <- function(x = TEJ,filename="表1.樣本篩選表",out=c("csv","txt")){
x$year <- year(x$date)
x.filt.ind <- filter(x, !TSE_code %in% c("M2800","M9900","M2331","W91",NA))
x.dropped.ind <- filter(x, TSE_code %in% c("M2800","M9900","M2331","W91",NA))
# M2800金融業 # M9900其他 # M2331其他電子 # W91存託憑證
y.na0 <- x.filt.ind %>% filter(FAMILY %in% NA | PB %in% NA | TA %in% NA | NetSales %in% c(NA,0) | employee %in% c(NA,0) | is.na(QUICK) | is.na(OUTINSTI))
# if want to fill out all nas, use "na.omit"
# 主要篩了五個變數，家族na、本益比na、總資產na、淨銷貨0.na、員工人數0.NA
y.full <- x.filt.ind %>% filter(!is.na(FAMILY) & !is.na(PB) & !is.na(TA) & !NetSales %in% c(NA,0) & !employee %in% c(NA,0) & !is.na(QUICK) & !is.na(OUTINSTI))
y.full.big5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) >= 5)
y.full.small5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) < 5)
tbA1 <- data.frame(
"intro" = c('2001~2015 original sample amount'
,'delete "financial ind."(TSE ind. code: M2800)'
,'delete "other ind."(TSE ind. code: M9900)'
,'delete "other electronic ind."(TSE ind. code: M2331)'
,'delete "DRs"(TSE ind. code: W91)'
,'delete empty ind.'
,'delete samples which had missing value, and will affect the research'
,'delete ind. which sample amount less then 5 firms in a year(list in filt.ind.png)'
,'Total sample amount after filtering='),
"samp.amount" = c(NROW(x) # 原始樣本數
, -NROW(filter(x.dropped.ind, TSE_code == "M2800")) # 刪除金融
, -NROW(filter(x.dropped.ind, TSE_code == "M9900")) # 刪除其他
, -NROW(filter(x.dropped.ind, TSE_code == "M2331")) # 刪除M2331其他電子
, -NROW(filter(x.dropped.ind, TSE_code == "W91")) # 刪除W91存託憑證
, -NROW(filter(x.dropped.ind, is.na(TSE_code))) # 刪除缺產業值
, -NROW(y.na0) # 刪除其他缺漏
, -NROW(y.full.small5) # 刪除家數不足5筆
, NROW(y.full.big5)) # 全樣本合計
)
tab.ind <- as.data.frame.matrix(table(y.full.small5$TSE_name,y.full.small5$year))
write.csv(na_count(y.na0),"其他闕漏值參考表.csv",row.names=TRUE)
if(out=="csv"){
filename <- capture.output(cat(filename,".csv",sep=""))
write.csv(tbA1, file=filename,row.names=FALSE)
write.csv(tab.ind, file="tab.ind.csv",row.names=FALSE)
}else{
#filename <- capture.output(cat(filename,".txt",sep=""))
#write(stargazer(tbA1,type = "text",summary = FALSE,align = c("r","r")),file = filename)
#write(xtable(tbA1,align="rrr",caption="",display = c(2,3)),file=filename)
table.png(obj=tbA1,name=filename,align="llr",caption="")
table.png(obj=tab.ind,name="tab.ind")
cat("Also print table ",filename,"in folder, complete.",sep="")
}
return(y.full.big5)
}
TEJ1 <- DBfilter(x = TEJ,filename="表1.樣本篩選表",out="txt")
DBfilter <- function(x = TEJ,filename="表1.樣本篩選表",out=c("csv","txt")){
x$year <- year(x$date)
x.filt.ind <- filter(x, !TSE_code %in% c("M2800","M9900","M2331","W91",NA))
x.dropped.ind <- filter(x, TSE_code %in% c("M2800","M9900","M2331","W91",NA))
# M2800金融業 # M9900其他 # M2331其他電子 # W91存託憑證
y.na0 <- x.filt.ind %>% filter(FAMILY %in% NA | PB %in% NA | TA %in% NA | NetSales %in% c(NA,0) | employee %in% c(NA,0) | is.na(QUICK) | is.na(OUTINSTI))
# if want to fill out all nas, use "na.omit"
# 主要篩了五個變數，家族na、本益比na、總資產na、淨銷貨0.na、員工人數0.NA
y.full <- x.filt.ind %>% filter(!is.na(FAMILY) & !is.na(PB) & !is.na(TA) & !NetSales %in% c(NA,0) & !employee %in% c(NA,0) & !is.na(QUICK) & !is.na(OUTINSTI))
y.full.big5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) >= 5)
y.full.small5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) < 5)
tbA1 <- data.frame(
"intro" = c('2001~2015 original sample amount'
,'delete "financial ind."(TSE ind. code: M2800)'
,'delete "other ind."(TSE ind. code: M9900)'
,'delete "other electronic ind."(TSE ind. code: M2331)'
,'delete "DRs"(TSE ind. code: W91)'
,'delete empty ind.'
,'delete samples which had missing value, and will affect the research'
,'delete ind. which sample amount less then 5 firms in a year(list in filt.ind.png)'
,'Total sample amount after filtering='),
"samp.amount" = c(NROW(x) # 原始樣本數
, -NROW(filter(x.dropped.ind, TSE_code == "M2800")) # 刪除金融
, -NROW(filter(x.dropped.ind, TSE_code == "M9900")) # 刪除其他
, -NROW(filter(x.dropped.ind, TSE_code == "M2331")) # 刪除M2331其他電子
, -NROW(filter(x.dropped.ind, TSE_code == "W91")) # 刪除W91存託憑證
, -NROW(filter(x.dropped.ind, is.na(TSE_code))) # 刪除缺產業值
, -NROW(y.na0) # 刪除其他缺漏
, -NROW(y.full.small5) # 刪除家數不足5筆
, NROW(y.full.big5)) # 全樣本合計
)
tab.ind <- as.data.frame.matrix(table(y.full.small5$TSE_name,y.full.small5$year))
write.csv(na_count(y.na0),"其他闕漏值參考表.csv",row.names=TRUE)
if(out=="csv"){
filename <- capture.output(cat(filename,".csv",sep=""))
write.csv(tbA1, file=filename,row.names=FALSE)
write.csv(tab.ind, file="tab.ind.csv",row.names=FALSE)
}else{
#filename <- capture.output(cat(filename,".txt",sep=""))
#write(stargazer(tbA1,type = "text",summary = FALSE,align = c("r","r")),file = filename)
#write(xtable(tbA1,align="rrr",caption="",display = c(2,3)),file=filename)
table.png(obj=tbA1,name=filename,align="llr")
table.png(obj=tab.ind,name="tab.ind")
cat("Also print table ",filename,"in folder, complete.",sep="")
}
return(y.full.big5)
}
TEJ1 <- DBfilter(x = TEJ,filename="表1.樣本篩選表",out="txt")
x = TEJ
filename="表1.樣本篩選表"
x$year <- year(x$date)
x.filt.ind <- filter(x, !TSE_code %in% c("M2800","M9900","M2331","W91",NA))
x.dropped.ind <- filter(x, TSE_code %in% c("M2800","M9900","M2331","W91",NA))
y.na0 <- x.filt.ind %>% filter(FAMILY %in% NA | PB %in% NA | TA %in% NA | NetSales %in% c(NA,0) | employee %in% c(NA,0) | is.na(QUICK) | is.na(OUTINSTI))
y.full <- x.filt.ind %>% filter(!is.na(FAMILY) & !is.na(PB) & !is.na(TA) & !NetSales %in% c(NA,0) & !employee %in% c(NA,0) & !is.na(QUICK) & !is.na(OUTINSTI))
y.full.big5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) >= 5)
y.full.small5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) < 5)
tbA1 <- data.frame(
"intro" = c('2001~2015 original sample amount'
,'delete "financial ind."(TSE ind. code: M2800)'
,'delete "other ind."(TSE ind. code: M9900)'
,'delete "other electronic ind."(TSE ind. code: M2331)'
,'delete "DRs"(TSE ind. code: W91)'
,'delete empty ind.'
,'delete samples which had missing value, and will affect the research'
,'delete ind. which sample amount less then 5 firms in a year(list in filt.ind.png)'
,'Total sample amount after filtering='),
"samp.amount" = c(NROW(x) # 原始樣本數
, -NROW(filter(x.dropped.ind, TSE_code == "M2800")) # 刪除金融
, -NROW(filter(x.dropped.ind, TSE_code == "M9900")) # 刪除其他
, -NROW(filter(x.dropped.ind, TSE_code == "M2331")) # 刪除M2331其他電子
, -NROW(filter(x.dropped.ind, TSE_code == "W91")) # 刪除W91存託憑證
, -NROW(filter(x.dropped.ind, is.na(TSE_code))) # 刪除缺產業值
, -NROW(y.na0) # 刪除其他缺漏
, -NROW(y.full.small5) # 刪除家數不足5筆
, NROW(y.full.big5)) # 全樣本合計
)
tab.ind <- as.data.frame.matrix(table(y.full.small5$TSE_name,y.full.small5$year))
write.csv(na_count(y.na0),"其他闕漏值參考表.csv",row.names=TRUE)
table.png(obj=tbA1,name=filename,align="llr")
table.png(obj=tab.ind,name="tab.ind")
traceback()
table.png <- function(obj, name,align=align) {
first <- name
name <- paste(name,".tex",sep="")
sink(file=name)
cat('
\\documentclass{report}
\\usepackage[paperwidth=5.5in,paperheight=7in,noheadfoot,margin=0in]{geometry}
\\begin{document}\\pagestyle{empty}
')
print(xtable(obj,align=align))
cat('
\\end{document}
')
sink()
texi2dvi(file=name)
cmd <- paste("dvipng -T tight", shQuote(paste(first,".dvi",sep="")))
invisible(sys(cmd))
cleaner <- c(".tex",".aux",".log",".dvi")
invisible(file.remove(paste(first,cleaner,sep="")))
}
table.png(obj=tbA1,name=filename,align="llr")
table.png(obj=tab.ind,name="tab.ind")
table.png(obj=tab.ind,name="tab.ind",align=rep("c",21))
DBfilter <- function(x = TEJ,filename="表1.樣本篩選表",out=c("csv","txt")){
x$year <- year(x$date)
x.filt.ind <- filter(x, !TSE_code %in% c("M2800","M9900","M2331","W91",NA))
x.dropped.ind <- filter(x, TSE_code %in% c("M2800","M9900","M2331","W91",NA))
# M2800金融業 # M9900其他 # M2331其他電子 # W91存託憑證
y.na0 <- x.filt.ind %>% filter(FAMILY %in% NA | PB %in% NA | TA %in% NA | NetSales %in% c(NA,0) | employee %in% c(NA,0) | is.na(QUICK) | is.na(OUTINSTI))
# if want to fill out all nas, use "na.omit"
# 主要篩了五個變數，家族na、本益比na、總資產na、淨銷貨0.na、員工人數0.NA
y.full <- x.filt.ind %>% filter(!is.na(FAMILY) & !is.na(PB) & !is.na(TA) & !NetSales %in% c(NA,0) & !employee %in% c(NA,0) & !is.na(QUICK) & !is.na(OUTINSTI))
y.full.big5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) >= 5)
y.full.small5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) < 5)
tbA1 <- data.frame(
"intro" = c('2001~2015 original sample amount'
,'delete "financial ind."(TSE ind. code: M2800)'
,'delete "other ind."(TSE ind. code: M9900)'
,'delete "other electronic ind."(TSE ind. code: M2331)'
,'delete "DRs"(TSE ind. code: W91)'
,'delete empty ind.'
,'delete samples which had missing value, and will affect the research'
,'delete ind. which sample amount less then 5 firms in a year(list in filt.ind.png)'
,'Total sample amount after filtering='),
"samp.amount" = c(NROW(x) # 原始樣本數
, -NROW(filter(x.dropped.ind, TSE_code == "M2800")) # 刪除金融
, -NROW(filter(x.dropped.ind, TSE_code == "M9900")) # 刪除其他
, -NROW(filter(x.dropped.ind, TSE_code == "M2331")) # 刪除M2331其他電子
, -NROW(filter(x.dropped.ind, TSE_code == "W91")) # 刪除W91存託憑證
, -NROW(filter(x.dropped.ind, is.na(TSE_code))) # 刪除缺產業值
, -NROW(y.na0) # 刪除其他缺漏
, -NROW(y.full.small5) # 刪除家數不足5筆
, NROW(y.full.big5)) # 全樣本合計
)
tab.ind <- as.data.frame.matrix(table(y.full.small5$TSE_name,y.full.small5$year))
write.csv(na_count(y.na0),"其他闕漏值參考表.csv",row.names=TRUE)
if(out=="csv"){
filename <- capture.output(cat(filename,".csv",sep=""))
write.csv(tbA1, file=filename,row.names=FALSE)
write.csv(tab.ind, file="tab.ind.csv",row.names=FALSE)
}else{
#filename <- capture.output(cat(filename,".txt",sep=""))
#write(stargazer(tbA1,type = "text",summary = FALSE,align = c("r","r")),file = filename)
#write(xtable(tbA1,align="rrr",caption="",display = c(2,3)),file=filename)
table.png(obj=tbA1,name=filename,align="llr")
table.png(obj=tab.ind,name="tab.ind",align=rep("c",21))
cat("Also print table ",filename,"in folder, complete.",sep="")
}
return(y.full.big5)
}
TEJ1 <- DBfilter(x = TEJ,filename="表1.樣本篩選表",out="txt")
table.png(obj = tbA1, name = filename, align = "llr")
table.png(obj = tab.ind, name = "tab.ind", align = rep("c",21))
DBfilter <- function(x = TEJ,filename="表1.樣本篩選表",out=c("csv","txt")){
x$year <- year(x$date)
x.filt.ind <- filter(x, !TSE_code %in% c("M2800","M9900","M2331","W91",NA))
x.dropped.ind <- filter(x, TSE_code %in% c("M2800","M9900","M2331","W91",NA))
# M2800金融業 # M9900其他 # M2331其他電子 # W91存託憑證
y.na0 <- x.filt.ind %>% filter(FAMILY %in% NA | PB %in% NA | TA %in% NA | NetSales %in% c(NA,0) | employee %in% c(NA,0) | is.na(QUICK) | is.na(OUTINSTI))
# if want to fill out all nas, use "na.omit"
# 主要篩了五個變數，家族na、本益比na、總資產na、淨銷貨0.na、員工人數0.NA
y.full <- x.filt.ind %>% filter(!is.na(FAMILY) & !is.na(PB) & !is.na(TA) & !NetSales %in% c(NA,0) & !employee %in% c(NA,0) & !is.na(QUICK) & !is.na(OUTINSTI))
y.full.big5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) >= 5)
y.full.small5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) < 5)
tbA1 <- data.frame(
"intro" = c('2001~2015 original sample amount'
,'delete "financial ind."(TSE ind. code: M2800)'
,'delete "other ind."(TSE ind. code: M9900)'
,'delete "other electronic ind."(TSE ind. code: M2331)'
,'delete "DRs"(TSE ind. code: W91)'
,'delete empty ind.'
,'delete samples which had missing value, and will affect the research'
,'delete ind. which sample amount less then 5 firms in a year(list in filt.ind.png)'
,'Total sample amount after filtering='),
"samp.amount" = c(NROW(x) # 原始樣本數
, -NROW(filter(x.dropped.ind, TSE_code == "M2800")) # 刪除金融
, -NROW(filter(x.dropped.ind, TSE_code == "M9900")) # 刪除其他
, -NROW(filter(x.dropped.ind, TSE_code == "M2331")) # 刪除M2331其他電子
, -NROW(filter(x.dropped.ind, TSE_code == "W91")) # 刪除W91存託憑證
, -NROW(filter(x.dropped.ind, is.na(TSE_code))) # 刪除缺產業值
, -NROW(y.na0) # 刪除其他缺漏
, -NROW(y.full.small5) # 刪除家數不足5筆
, NROW(y.full.big5)) # 全樣本合計
)
tab.ind <- as.data.frame.matrix(table(y.full.small5$TSE_name,y.full.small5$year))
write.csv(na_count(y.na0),"其他闕漏值參考表.csv",row.names=TRUE)
if(out=="csv"){
filename <- capture.output(cat(filename,".csv",sep=""))
write.csv(tbA1, file=filename,row.names=FALSE)
write.csv(tab.ind, file="tab.ind.csv",row.names=FALSE)
}else{
#filename <- capture.output(cat(filename,".txt",sep=""))
#write(stargazer(tbA1,type = "text",summary = FALSE,align = c("r","r")),file = filename)
#write(xtable(tbA1,align="rrr",caption="",display = c(2,3)),file=filename)
table.png(obj = tbA1, name = filename, align = "llr")
table.png(obj = tab.ind, name = "tab.ind", align = rep("c",21))
cat("Also print table ",filename,"in folder, complete.",sep="")
}
return(y.full.big5)
}
TEJ1 <- DBfilter(x = TEJ,filename="表1.樣本篩選表",out="txt")
x = TEJ
class(table(x$TSE_code,x$date))
atr <- table(x$TSE_code,x$date)
atr
View(atr)
atr2 <- as.data.frame(atr)
View(atr2)
atr <- table(x$TSE_code,x$date)
atr2 <- as.data.frame.matrix(atr)
View(atr2)
DBfilter <- function(x = TEJ,filename="表1.樣本篩選表",out=c("csv","txt")){
x$year <- year(x$date)
x.filt.ind <- filter(x, !TSE_code %in% c("M2800","M9900","M2331","W91",NA))
x.dropped.ind <- filter(x, TSE_code %in% c("M2800","M9900","M2331","W91",NA))
# M2800金融業 # M9900其他 # M2331其他電子 # W91存託憑證
y.na0 <- x.filt.ind %>% filter(FAMILY %in% NA | PB %in% NA | TA %in% NA | NetSales %in% c(NA,0) | employee %in% c(NA,0) | is.na(QUICK) | is.na(OUTINSTI))
# if want to fill out all nas, use "na.omit"
# 主要篩了五個變數，家族na、本益比na、總資產na、淨銷貨0.na、員工人數0.NA
y.full <- x.filt.ind %>% filter(!is.na(FAMILY) & !is.na(PB) & !is.na(TA) & !NetSales %in% c(NA,0) & !employee %in% c(NA,0) & !is.na(QUICK) & !is.na(OUTINSTI))
y.full.big5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) >= 5)
y.full.small5 <- y.full %>% group_by(TSE_code,year) %>% filter(NROW(TSE_code) < 5)
tbA1 <- data.frame(
"intro" = c('2001~2015 original sample amount'
,'delete "financial ind."(TSE ind. code: M2800)'
,'delete "other ind."(TSE ind. code: M9900)'
,'delete "other electronic ind."(TSE ind. code: M2331)'
,'delete "DRs"(TSE ind. code: W91)'
,'delete empty ind.'
,'delete samples which had missing value, and will affect the research'
,'delete ind. which sample amount less then 5 firms in a year(list in filt.ind.png)'
,'Total sample amount after filtering='),
"samp.amount" = c(NROW(x) # 原始樣本數
, -NROW(filter(x.dropped.ind, TSE_code == "M2800")) # 刪除金融
, -NROW(filter(x.dropped.ind, TSE_code == "M9900")) # 刪除其他
, -NROW(filter(x.dropped.ind, TSE_code == "M2331")) # 刪除M2331其他電子
, -NROW(filter(x.dropped.ind, TSE_code == "W91")) # 刪除W91存託憑證
, -NROW(filter(x.dropped.ind, is.na(TSE_code))) # 刪除缺產業值
, -NROW(y.na0) # 刪除其他缺漏
, -NROW(y.full.small5) # 刪除家數不足5筆
, NROW(y.full.big5)) # 全樣本合計
)
tab <- table(y.full.small5$TSE_name,y.full.small5$year)
tab.ind <- as.data.frame.matrix(tab)
write.csv(na_count(y.na0),"其他闕漏值參考表.csv",row.names=TRUE)
if(out=="csv"){
filename <- capture.output(cat(filename,".csv",sep=""))
write.csv(tbA1, file=filename,row.names=FALSE)
write.csv(tab.ind, file="tab.ind.csv",row.names=FALSE)
}else{
#filename <- capture.output(cat(filename,".txt",sep=""))
#write(stargazer(tbA1,type = "text",summary = FALSE,align = c("r","r")),file = filename)
#write(xtable(tbA1,align="rrr",caption="",display = c(2,3)),file=filename)
table.png(obj = tbA1, name = filename, align = "llr")
write.csv(tab.ind, file="tab.ind.csv",row.names=FALSE)
cat("Also print table ",filename,"in folder, complete.",sep="")
}
return(y.full.big5)
}
TEJ1 <- DBfilter(x = TEJ,filename="表1.樣本篩選表",out="txt")
q()
